<!DOCTYPE html>
<html lang="ms">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistem Pemantauan Perbelanjaan</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="bg-primary text-white py-3 mb-4">
      <div class="container">
        <h1 class="text-center">
          <i class="bi bi-wallet2"></i> Sistem Pemantauan Perbelanjaan
        </h1>
      </div>
    </header>

    <main class="container mb-5">
      <!-- Section 1: Monthly Balance (READ-ONLY) -->
      <section class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi bi-cash-stack"></i> Duit Baki Bulanan (Dikira)
          </h5>
        </div>
        <div class="card-body">
          <div id="monthlyBalanceDisplay" class="text-center py-3">
            <h4 id="currentBalance">RM 0.00</h4>
            <p id="balancePeriod">Tempoh: Menunggu data gaji...</p>
          </div>
        </div>
      </section>

      <!-- Section 2: Salary Amount -->
      <section class="card mb-4">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0"><i class="bi bi-cash"></i> Nilai Duit Gaji</h5>
          <button class="btn btn-sm btn-outline-primary" id="editSalaryBtn">
            <i class="bi bi-pencil"></i> Edit
          </button>
        </div>
        <div class="card-body">
          <div id="salaryDisplay" class="text-center py-3">
            <h4 id="currentSalary">RM 0.00</h4>
            <p id="salaryPeriod">Tempoh: -</p>
          </div>
          <div id="salaryEdit" class="d-none">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Bulan</th>
                    <th>Jumlah</th>
                    <th>Tempoh</th>
                    <th>Tindakan</th>
                  </tr>
                </thead>
                <tbody id="salaryTableBody">
                  <!-- Data akan dimuatkan melalui JavaScript -->
                </tbody>
              </table>
            </div>
            <button class="btn btn-primary" id="addSalaryBtn">
              <i class="bi bi-plus-circle"></i> Tambah Rekod Baru
            </button>
          </div>
        </div>
      </section>

      <!-- Section 3: Total Monthly Expenses -->
      <section class="card mb-4">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0">
            <i class="bi bi-cart"></i> Jumlah Perbelanjaan Bulanan
          </h5>
          <button class="btn btn-sm btn-outline-primary" id="editExpensesBtn">
            <i class="bi bi-pencil"></i> Edit
          </button>
        </div>
        <div class="card-body">
          <div id="expensesDisplay" class="text-center py-3">
            <h4 id="currentExpenses">RM 0.00</h4>
            <p id="expensesPeriod">Tempoh: -</p>
          </div>
          <div id="expensesEdit" class="d-none">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Tarikh</th>
                    <th>Perihal</th>
                    <th>Jumlah</th>
                    <th>Kategori</th>
                    <th>Tindakan</th>
                  </tr>
                </thead>
                <tbody id="expensesTableBody">
                  <!-- Data akan dimuatkan melalui JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-primary" id="addExpenseBtn">
                <i class="bi bi-plus-circle"></i> Tambah Perbelanjaan Baru
              </button>
              <button
                class="btn btn-secondary"
                id="toggleExpensesBtn"
                style="display: none"
              >
                Show All
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: Subscriptions -->
      <section class="card mb-4">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0"><i class="bi bi-arrow-repeat"></i> Subscription</h5>
          <button
            class="btn btn-sm btn-outline-primary"
            id="editSubscriptionsBtn"
          >
            <i class="bi bi-pencil"></i> Edit
          </button>
        </div>
        <div class="card-body">
          <div id="subscriptionsDisplay" class="text-center py-3">
            <h4 id="currentSubscriptions">RM 0.00</h4>
            <p>Jumlah langganan bulanan</p>
          </div>
          <div id="subscriptionsEdit" class="d-none">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Perihal</th>
                    <th>Jumlah</th>
                    <th>Tarikh Mula</th>
                    <th>Tarikh Akhir</th>
                    <th>Tindakan</th>
                  </tr>
                </thead>
                <tbody id="subscriptionsTableBody">
                  <!-- Data akan dimuatkan melalui JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-primary" id="addSubscriptionBtn">
                <i class="bi bi-plus-circle"></i> Tambah Langganan Baru
              </button>
              <button
                class="btn btn-secondary"
                id="toggleSubscriptionsBtn"
                style="display: none"
              >
                Show All
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Section 5: Paylater/Installment -->
      <section class="card mb-4">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0">
            <i class="bi bi-credit-card"></i> Paylater / Installment
          </h5>
          <button
            class="btn btn-sm btn-outline-primary"
            id="editInstallmentsBtn"
          >
            <i class="bi bi-pencil"></i> Edit
          </button>
        </div>
        <div class="card-body">
          <div id="installmentsDisplay" class="text-center py-3">
            <h4 id="currentInstallments">RM 0.00</h4>
            <p>Jumlah bayaran ansuran bulanan</p>
          </div>
          <div id="installmentsEdit" class="d-none">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Perihal</th>
                    <th>Jumlah</th>
                    <th>Tempoh (bulan)</th>
                    <th>Tarikh Bayaran</th>
                    <th>Tarikh Akhir</th>
                    <th>Tindakan</th>
                  </tr>
                </thead>
                <tbody id="installmentsTableBody">
                  <!-- Data akan dimuatkan melalui JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-primary" id="addInstallmentBtn">
                <i class="bi bi-plus-circle"></i> Tambah Ansuran Baru
              </button>
              <button
                class="btn btn-secondary"
                id="toggleInstallmentsBtn"
                style="display: none"
              >
                Show All
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Section 6: Credit Card Balance -->
      <section class="card mb-4">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0">
            <i class="bi bi-credit-card-2-back"></i> Credit Card Balance
          </h5>
          <button class="btn btn-sm btn-outline-primary" id="editCreditCardBtn">
            <i class="bi bi-pencil"></i> Edit
          </button>
        </div>
        <div class="card-body">
          <div id="creditCardDisplay" class="text-center py-3">
            <h4 id="currentCreditCard">RM 0.00</h4>
            <p id="creditCardPeriod">Tempoh: Menunggu data gaji...</p>
          </div>
          <div id="creditCardEdit" class="d-none">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Tarikh</th>
                    <th>Perihal</th>
                    <th>Jumlah</th>
                    <th>Tindakan</th>
                  </tr>
                </thead>
                <tbody id="creditCardTableBody">
                  <!-- Data akan dimuatkan melalui JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-primary" id="addCreditCardBtn">
                <i class="bi bi-plus-circle"></i> Tambah Rekod Baru
              </button>
              <button
                class="btn btn-secondary"
                id="toggleCreditCardBtn"
                style="display: none"
              >
                Show All
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Section 7: Debit Card / Simpanan Lain Balance -->
      <section class="card mb-4">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0">
            <i class="bi bi-wallet2"></i> Debit Card / Simpanan Lain Balance
          </h5>
          <button class="btn btn-sm btn-outline-primary" id="editDebitCardBtn">
            <i class="bi bi-pencil"></i> Edit
          </button>
        </div>
        <div class="card-body">
          <div id="debitCardDisplay" class="text-center py-3">
            <h4 id="currentDebitCard">RM 0.00</h4>
            <p id="debitCardPeriod">Tempoh: Menunggu data gaji...</p>
          </div>
          <div id="debitCardEdit" class="d-none">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Tarikh</th>
                    <th>Perihal</th>
                    <th>Jumlah</th>
                    <th>Tindakan</th>
                  </tr>
                </thead>
                <tbody id="debitCardTableBody">
                  <!-- Data akan dimuatkan melalui JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-primary" id="addDebitCardBtn">
                <i class="bi bi-plus-circle"></i> Tambah Rekod Baru
              </button>
              <button
                class="btn btn-secondary"
                id="toggleDebitCardBtn"
                style="display: none"
              >
                Show All
              </button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Modal Forms -->
    <!-- Salary Modal -->
    <div class="modal fade" id="salaryModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah/Edit Gaji</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="salaryForm">
              <div class="mb-3">
                <label for="salaryMonth" class="form-label">Bulan</label>
                <input
                  type="month"
                  class="form-control"
                  id="salaryMonth"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="salaryAmount" class="form-label">Jumlah (RM)</label>
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="salaryAmount"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="salaryStartDate" class="form-label"
                  >Tarikh Mula</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="salaryStartDate"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="salaryEndDate" class="form-label"
                  >Tarikh Akhir</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="salaryEndDate"
                  required
                />
              </div>
              <input type="hidden" id="salaryId" />
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-primary" id="saveSalaryBtn">
              Simpan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Expense Modal -->
    <div class="modal fade" id="expenseModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah/Edit Perbelanjaan</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="expenseForm">
              <div class="mb-3">
                <label for="expenseDate" class="form-label">Tarikh</label>
                <input
                  type="date"
                  class="form-control"
                  id="expenseDate"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="expenseDescription" class="form-label"
                  >Perihal</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="expenseDescription"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="expenseAmount" class="form-label"
                  >Jumlah (RM)</label
                >
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="expenseAmount"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="expenseCategory" class="form-label">Kategori</label>
                <select class="form-select" id="expenseCategory" required>
                  <option value="">Pilih Kategori</option>
                  <option value="Keperluan">Keperluan</option>
                  <option value="Bukan Keperluan">Bukan Keperluan</option>
                  <option value="Subscription">Subscription</option>
                  <option value="Paylater/Installment">
                    Paylater/Installment
                  </option>
                  <option value="Lain-lain">Lain-lain</option>
                </select>
              </div>
              <div id="subscriptionFields" class="d-none">
                <div class="mb-3">
                  <label for="expenseStartDate" class="form-label"
                    >Tarikh Mula Langganan</label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="expenseStartDate"
                  />
                </div>
                <div class="mb-3">
                  <label for="expenseEndDate" class="form-label"
                    >Tarikh Akhir Langganan</label
                  >
                  <input type="date" class="form-control" id="expenseEndDate" />
                </div>
              </div>
              <div id="installmentFields" class="d-none">
                <div class="mb-3">
                  <label for="installmentMonths" class="form-label"
                    >Tempoh (bulan)</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="installmentMonths"
                  />
                </div>
                <div class="mb-3">
                  <label for="installmentPaymentDate" class="form-label"
                    >Tarikh Bayaran Bulanan</label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="installmentPaymentDate"
                  />
                </div>
                <div class="mb-3">
                  <label for="installmentEndDate" class="form-label"
                    >Tarikh Akhir Bayaran</label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="installmentEndDate"
                  />
                </div>
              </div>
              <input type="hidden" id="expenseId" />
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-primary" id="saveExpenseBtn">
              Simpan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Subscription Modal -->
    <div
      class="modal fade"
      id="subscriptionModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah/Edit Langganan</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="subscriptionForm">
              <div class="mb-3">
                <label for="subscriptionDescription" class="form-label"
                  >Perihal</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="subscriptionDescription"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="subscriptionAmount" class="form-label"
                  >Jumlah (RM)</label
                >
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="subscriptionAmount"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="subscriptionStartDate" class="form-label"
                  >Tarikh Mula</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="subscriptionStartDate"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="subscriptionEndDate" class="form-label"
                  >Tarikh Akhir</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="subscriptionEndDate"
                  required
                />
              </div>
              <input type="hidden" id="subscriptionId" />
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="saveSubscriptionBtn"
            >
              Simpan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Installment Modal -->
    <div
      class="modal fade"
      id="installmentModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah/Edit Ansuran</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="installmentForm">
              <div class="mb-3">
                <label for="installmentDescription" class="form-label"
                  >Perihal</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="installmentDescription"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="installmentAmount" class="form-label"
                  >Jumlah (RM)</label
                >
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="installmentAmount"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="installmentMonths" class="form-label"
                  >Tempoh (bulan)</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="installmentMonths"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="installmentPaymentDate" class="form-label"
                  >Tarikh Bayaran</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="installmentPaymentDate"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="installmentEndDate" class="form-label"
                  >Tarikh Akhir</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="installmentEndDate"
                  required
                />
              </div>
              <input type="hidden" id="installmentId" />
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="saveInstallmentBtn"
            >
              Simpan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Credit Card Modal -->
    <div
      class="modal fade"
      id="creditCardModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah/Edit Credit Card Balance</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="creditCardForm">
              <div class="mb-3">
                <label for="creditCardDate" class="form-label">Tarikh</label>
                <input
                  type="date"
                  class="form-control"
                  id="creditCardDate"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="creditCardDescription" class="form-label"
                  >Perihal</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="creditCardDescription"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="creditCardAmount" class="form-label"
                  >Jumlah (RM)</label
                >
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="creditCardAmount"
                  required
                />
              </div>
              <input type="hidden" id="creditCardId" />
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="saveCreditCardBtn"
            >
              Simpan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Debit Card Modal -->
    <div
      class="modal fade"
      id="debitCardModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              Tambah/Edit Debit Card / Simpanan Lain Balance
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="debitCardForm">
              <div class="mb-3">
                <label for="debitCardDate" class="form-label">Tarikh</label>
                <input
                  type="date"
                  class="form-control"
                  id="debitCardDate"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="debitCardDescription" class="form-label"
                  >Perihal</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="debitCardDescription"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="debitCardAmount" class="form-label"
                  >Jumlah (RM)</label
                >
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="debitCardAmount"
                  required
                />
              </div>
              <input type="hidden" id="debitCardId" />
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-primary" id="saveDebitCardBtn">
              Simpan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
      <div
        id="toast"
        class="toast"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="toast-header">
          <strong class="me-auto">Notifikasi</strong>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
        <div class="toast-body" id="toastMessage">Operasi berjaya!</div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="app.js"></script>
  </body>
</html>
